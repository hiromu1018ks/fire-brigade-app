# 消防団業務効率化アプリ 要件定義書・技術選定書

## 1. プロジェクト概要

### 1.1 プロジェクト名
消防団業務効率化アプリ

### 1.2 目的
地域消防団の業務効率化を図り、出動時の迅速な対応と日常業務のデジタル化を実現する。

### 1.3 背景
現在の消防団業務では、アナログな連絡手段や管理方法により、緊急時の対応効率や日常業務の生産性に課題がある。特に出動時の情報伝達や参集状況の把握に改善の余地がある。

## 2. 現状分析

### 2.1 現状の課題
- **出動時の情報不足**: 防災無線が聞き取りづらく、LINEでも詳細情報が不足
- **班別通知の困難**: 地域別の出動に対して適切な班のみに連絡することが困難
- **参集状況の把握困難**: 詰所参集者と現場直行者の人数が把握できない
- **スケジュール管理の非効率**: 訓練等の出席者数把握が困難
- **記録の属人化**: 反省点や改善点の集約ができない
- **紙ベース管理**: 車両点検記録、装備管理が紙で非効率
- **手当計算の手作業**: 参加実績の集計が手作業

### 2.2 現在の運用方法
- **連絡手段**: LINEグループ
- **参集確認**: 手動でのカウント・メモ
- **情報共有**: LINEグループでの情報共有

## 3. システム要件

### 3.1 機能要件

#### 3.1.1 Core機能：出動管理システム

**出動情報配信機能**
- 現場の詳細情報表示（住所、目印、アクセス情報）
- 災害種別、規模、注意事項の配信
- 地図連携によるルート表示
- **班別通知システム**: 出動地域に応じて担当班のみに通知配信
- プッシュ通知による緊急連絡

**参集状況リアルタイム管理機能**
- 詰所参集 / 現場直行の選択機能
- 参集予定時刻の入力
- リアルタイム人数把握ダッシュボード
- 班別参集状況の自動集計

**班編成管理機能**
- 分団・班の階層構造管理
- 消防団員の班配属管理
- 班別担当地域の設定
- 班長・副班長等の役職管理

#### 3.1.2 Sub機能：日常業務管理

**訓練・会議スケジュール管理機能**
- スケジュール登録・編集
- 出席確認・人数把握
- 出席率の自動計算

**車両・装備管理機能**
- 消防車点検記録のデジタル化
- 運転記録の管理
- 装備・備品の在庫管理
- 点検スケジュールの管理

**活動記録・反省会システム**
- 出動記録の登録
- 訓練記録の管理
- 反省点・改善点の入力・集約
- 活動履歴の検索・閲覧

**参加実績・手当計算機能**
- 出動・訓練参加実績の自動記録
- 手当計算の自動化
- 実績レポートの生成

### 3.2 非機能要件

**性能要件**
- 出動通知の配信遅延：5秒以内
- 参集状況更新のリアルタイム性：2秒以内
- システム応答時間：3秒以内

**可用性要件**
- システム稼働率：99.5%以上
- 緊急時の確実な通知配信

**セキュリティ要件**
- 消防団員の認証・認可機能
- 個人情報の適切な管理
- 通信の暗号化

**ユーザビリティ要件**
- スマートフォン対応（PWA）
- 直感的な操作性
- 緊急時でも迷わず操作可能

## 4. 画面構成・ユーザーフロー

### 4.1 主要画面
1. **ログイン画面**: 認証機能
2. **ダッシュボード**: 通知一覧、緊急出動状況
3. **出動管理画面**: 出動詳細、参集状況、地図表示
4. **スケジュール画面**: 訓練・会議予定、出席管理
5. **装備管理画面**: 車両・装備の記録・管理
6. **活動記録画面**: 出動・訓練記録、反省点入力
7. **実績管理画面**: 参加実績、手当計算

### 4.2 ユーザーフロー例
```
【出動時のフロー】
1. システムから出動通知受信
2. 出動詳細画面で現場情報確認
3. 参集方法選択（詰所 or 現場直行）
4. リアルタイムで参集状況確認
5. 出動完了後、活動記録入力
```

## 5. 技術選定

### 5.1 システム構成

```
【フロントエンド】
Next.js (React) + TypeScript + Tailwind CSS + shadcn/ui

【バックエンド】
Node.js + Next.js API Routes + Socket.io

【データベース】
PostgreSQL + Prisma ORM

【認証】
Auth.js

【外部API】
Google Maps API + Web Push API + Zod + React Hook Form

【インフラ】
Vercel (推奨) または AWS (ECS + ALB + RDS + S3)

【開発・運用】
Docker Compose + GitHub Actions + Vercel
```

### 5.2 技術選定理由

#### 5.2.1 TypeScript + Next.js
**選定理由**: 消防団は緊急性が求められるため、型安全性によるバグ削減とSSRによる高速表示が重要。Next.jsのファイルベースルーティングで迅速な開発も可能。

**他選択肢との比較**: React単体だとSSR設定が複雑、Vueは学習コストを考慮してTypeScriptとの親和性でNext.jsを選択。

#### 5.2.2 PostgreSQL + Prisma
**選定理由**: 出動記録、訓練記録、装備管理などリレーショナルなデータが多いため。PrismaでTypeScript連携と型安全なDB操作を実現。消防団の重要な記録データにはACID特性が必要。

**他選択肢との比較**: MongoDBは非構造化だが消防団は構造化データが中心、MySQLよりPostgreSQLはJSON型やGIS機能で拡張性が高い。

#### 5.2.3 Socket.io
**選定理由**: 出動時の参集状況をリアルタイム共有する必要があり、WebSocketでの双方向通信が必須。Socket.ioは接続の安定性とフォールバック機能で緊急時の通信を保証。

**他選択肢との比較**: 生のWebSocketは接続管理が複雑、Server-Sent Eventsは一方向のみ。

#### 5.2.4 Auth.js
**選定理由**: 消防団員の権限管理（分団長、一般団員等）が必要で、Next.jsとのシームレスな連携が可能。セキュリティのベストプラクティスが組み込み済み。NextAuth.jsからの正式な後継で、よりモダンなアーキテクチャで設計されている。

**他選択肢との比較**: 自作認証はセキュリティリスク、Auth0等は小規模アプリには重厚すぎる。

#### 5.2.5 Google Maps API
**選定理由**: 消防団の最重要機能である現場への迅速な到着のため、地図とルート案内は必須。Googleはデータの正確性と更新頻度で最も信頼性が高い。

**他選択肢との比較**: OpenStreetMapは無料だが、緊急時の正確性でGoogleが最適。

#### 5.2.6 AWS ECS
**選定理由**: Dockerとの親和性でCI/CDの自動化が容易。オートスケーリングで出動時のアクセス集中に対応。マネージドサービスでインフラ運用負荷を削減。

**他選択肢との比較**: EC2は運用負荷大、Lambdaは常時接続のSocket.ioに不適。

### 5.3 アーキテクチャ構成

```
┌─────────────────┐
│   Web Browser   │ ← PWA対応
│  (Next.js App)  │
└─────────────────┘
         │
         │ HTTPS
         ▼
┌─────────────────┐
│   AWS ALB       │
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   AWS ECS       │ ← Docker Container
│  (Next.js API)  │ ← Socket.io Server
└─────────────────┘
         │
         ▼
┌─────────────────┐
│   AWS RDS       │ ← PostgreSQL
│  (PostgreSQL)   │
└─────────────────┘

外部連携:
- Google Maps API
- Web Push API
```

### 5.4 新技術の追加推奨

#### 5.4.1 フォーム管理の改善
- **React Hook Form + Zod**: フォームのパフォーマンスとバリデーションの改善
- 緊急時のフォーム入力でのユーザーエクスペリエンス向上

#### 5.4.2 データベース選択肢
- **Supabase**: PostgreSQL + リアルタイム機能 + 認証サービスの統合ソリューション
- ゼロコンフィグでのリアルタイム更新、サブスクリプション機能

#### 5.4.3 パフォーマンス最適化
- **Next.js App Router**: パフォーマンスとSEOの改善
- **TanStack Query**: サーバー状態管理とキャッシュ最適化

### 5.5 技術選定の全体戦略
「緊急性・確実性・保守性」を軸に、現場の課題解決を最優先にした技術選定を実施。モダンな技術スタックによる開発効率と、消防団業務に必要な信頼性を両立。

## 6. 開発計画

### 6.1 MVP（最小限の機能）
1. **フェーズ1**: 出動管理システム（出動通知、参集状況管理）
2. **フェーズ2**: スケジュール管理機能
3. **フェーズ3**: 車両・装備管理機能
4. **フェーズ4**: 活動記録・実績管理機能

### 6.2 開発環境
- **コンテナ化**: Docker Compose
- **CI/CD**: GitHub Actions
- **コード管理**: Git / GitHub
- **デプロイ**: AWS (ECS)

---

**文書作成日**: 2025年6月9日  
**作成者**: プロジェクト担当者  
**版数**: 1.0