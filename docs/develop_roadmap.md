# 消防団業務効率化アプリ 開発ロードマップ

## 現在の開発状況

### ✅ 完了済み
- Next.js 15 + TypeScript プロジェクトの初期セットアップ
- Tailwind CSS + shadcn/ui の設定
- PostgreSQL Docker Compose 環境の構築
- 基本的なレイアウト（layout.tsx）とホームページ（page.tsx）の作成
- プロジェクト要件定義・技術選定の完了

### 📍 現在の状態
- ホームページに機能概要を表示する静的なサイト
- データベース接続未実装
- 認証機能未実装
- 実際の業務機能未実装

---

## 📈 段階的実装ロードマップ

### 【フェーズ1: 基盤整備】（推定期間: 1-2週間）

#### ステップ1.1: データベース接続とPrisma ORM設定
**目標**: PostgreSQLデータベースとの接続を確立し、班編成を考慮したデータ操作の基盤を作る

**手順**:
1. Prisma CLIをインストール
   ```bash
   npm install prisma @prisma/client
   npx prisma init
   ```

2. `.env.local`ファイルを作成してデータベース接続情報を設定
   ```
   DATABASE_URL="postgresql://fire_brigade_user:password123@localhost:5432/fire_brigade"
   ```

3. `prisma/schema.prisma`でデータベーススキーマを定義
   - User（消防団員）テーブル
   - **Group（班）テーブル** - 班編成管理
   - **Area（担当地域）テーブル** - 班別担当地域
   - 基本的なフィールドとリレーション

4. 初回マイグレーション実行
   ```bash
   npx prisma migrate dev --name init
   npx prisma generate
   ```

**学習ポイント**: 
- Prismaの基本的な使い方
- データベースマイグレーションの概念
- **リレーショナルデータベースの設計**（班と団員の関係）

#### ステップ1.2: 基本的なUI コンポーネントの作成
**目標**: shadcn/uiを使って再利用可能なUIコンポーネントを準備する

**手順**:
1. 必要なshadcn/uiコンポーネントをインストール
   ```bash
   npx shadcn@latest add button
   npx shadcn@latest add card
   npx shadcn@latest add input
   npx shadcn@latest add form
   ```

2. `src/components/ui/`フォルダにコンポーネントが追加されることを確認

3. ホームページでこれらのコンポーネントを使用してみる

**学習ポイント**: 
- shadcn/uiの使い方
- Reactコンポーネントの基本

#### ステップ1.3: 認証機能の実装
**目標**: Auth.jsを使って消防団員の認証システムを作る

**手順**:
1. Auth.jsのインストール
   ```bash
   npm install next-auth@beta @auth/prisma-adapter
   ```

2. `src/app/api/auth/[...nextauth]/route.ts`を作成
3. 簡単なCredentials Providerでメール/パスワード認証を実装
4. ログイン/ログアウトページの作成
5. 認証状態の確認機能を追加

**学習ポイント**: 
- Auth.jsの設定方法
- APIルートの作成方法
- 認証フローの理解

### 【フェーズ2: Core機能 - 出動管理システム】（推定期間: 2-3週間）

#### ステップ2.1: 出動情報管理の基盤作成
**目標**: 班別通知を考慮した出動情報を登録・表示できる基本的な機能を作る

**手順**:
1. データベーススキーマに出動関連テーブルを追加
   - Emergency（緊急出動）テーブル
   - EmergencyResponse（出動対応）テーブル
   - **班と地域の関連付け機能**

2. 出動情報登録フォームの作成
   ```
   /dashboard/emergency/new
   ```
   - **対象班の自動選択機能**（出動場所から判定）

3. 出動一覧ページの作成
   ```
   /dashboard/emergency
   ```
   - **班別フィルタリング機能**

4. 出動詳細ページの作成
   ```
   /dashboard/emergency/[id]
   ```
   - **班別参集状況の表示**

**学習ポイント**: 
- Formの作成とバリデーション
- データの CRUD 操作
- 動的ルーティング
- **条件分岐による通知対象の制御**

#### ステップ2.2: 参集状況管理機能
**目標**: 班員が参集状況を報告し、班別にリアルタイムで確認できる機能を作る

**手順**:
1. 参集状況報告フォームの作成
   - 「詰所参集」「現場直行」の選択
   - 到着予定時刻の入力
   - **自動的に所属班が判定される機能**

2. 参集状況一覧の表示
   - **班別参集者数のリアルタイム表示**
   - **班別参集者リストの表示**
   - 班長向けの班内状況確認画面

3. 基本的なダッシュボードの作成
   ```
   /dashboard
   ```
   - **所属班の出動情報を優先表示**

**学習ポイント**: 
- 状態管理の基本
- リアルタイム更新（後でSocket.ioに置き換え予定）
- **ユーザー権限による表示制御**

#### ステップ2.3: 班別通知機能の基礎実装
**目標**: 出動地域に応じて該当班のみに通知する仕組みを作る

**手順**:
1. Web Push APIの基本実装
2. **班別通知の送信機能**
   - 出動場所から担当班を自動判定
   - 該当班のみに通知配信
3. 通知履歴の管理
4. **班長向けの一斉通知機能**

**学習ポイント**: 
- Web Push APIの使い方
- ブラウザ通知の仕組み
- **条件分岐による対象絞り込み**

### 【フェーズ3: 日常業務管理機能】（推定期間: 2-3週間）

#### ステップ3.1: スケジュール管理
**目標**: 訓練や会議のスケジュール管理ができる機能を作る

**手順**:
1. スケジュール関連のデータベーステーブル作成
2. スケジュール登録・編集フォーム
3. カレンダー表示機能
4. 出席確認機能

#### ステップ3.2: 活動記録システム
**目標**: 出動や訓練の記録を残せる機能を作る

**手順**:
1. 活動記録のデータベース設計
2. 記録入力フォーム
3. 記録一覧・検索機能
4. 反省点・改善点の管理

### 【フェーズ4: リアルタイム機能とモバイル対応】（推定期間: 2週間）

#### ステップ4.1: Socket.ioによるリアルタイム通信
**目標**: 出動時の参集状況をリアルタイムで共有する

**手順**:
1. Socket.ioのサーバー・クライアント実装
2. リアルタイム参集状況更新
3. リアルタイム通知配信

#### ステップ4.2: PWA対応とモバイル最適化
**目標**: スマートフォンでの使いやすさを向上させる

**手順**:
1. PWA manifest.jsonの設定
2. Service Workerの実装
3. オフライン機能の基本実装
4. モバイルUIの最適化

### 【フェーズ5: 高度な機能】（推定期間: 2-3週間）

#### ステップ5.1: 地図連携機能
**目標**: Google Maps APIを使って現場への経路案内を提供する

#### ステップ5.2: 装備・車両管理
**目標**: 消防車両と装備品の管理機能を実装する

#### ステップ5.3: レポート・分析機能
**目標**: 活動実績の分析とレポート生成機能を実装する

---

## 🛠️ 各フェーズで習得する技術

### フェーズ1で学ぶこと
- **データベース**: Prisma ORM、マイグレーション
- **UI**: shadcn/ui、Tailwind CSS
- **認証**: Auth.js、セッション管理

### フェーズ2で学ぶこと
- **API**: Next.js API Routes、RESTful API設計
- **フォーム**: React Hook Form、バリデーション
- **状態管理**: React useState、useEffect

### フェーズ3で学ぶこと
- **日付処理**: 日付ライブラリの使用
- **ファイル操作**: 画像アップロード、ファイル管理
- **検索機能**: データベース検索、フィルタリング

### フェーズ4で学ぶこと
- **リアルタイム通信**: Socket.io、WebSocket
- **PWA**: Service Worker、アプリ化
- **モバイル対応**: レスポンシブデザイン

### フェーズ5で学ぶこと
- **外部API**: Google Maps API連携
- **データ分析**: チャートライブラリ、統計処理
- **最適化**: パフォーマンス改善、セキュリティ強化

---

## 📚 学習リソースと参考資料

### 基本的な学習リソース
- **Next.js**: [公式ドキュメント](https://nextjs.org/docs)
- **Prisma**: [公式ドキュメント](https://www.prisma.io/docs)
- **shadcn/ui**: [公式サイト](https://ui.shadcn.com/)
- **Auth.js**: [公式ドキュメント](https://authjs.dev/)

### 実装時の参考
- 各フェーズごとに詳細な実装ガイドを作成予定
- コードサンプルとコメント付きの実装例を提供
- 躓きやすいポイントと解決策をまとめたTips集を作成予定

---

## 🎯 次にやるべきこと

**すぐに始められる作業**:
1. PostgreSQLコンテナを起動して接続確認
   ```bash
   docker-compose up -d postgres
   ```

2. Prismaの初期設定
   ```bash
   npm install prisma @prisma/client
   npx prisma init
   ```

3. 基本的なshadcn/uiコンポーネントのインストール
   ```bash
   npx shadcn@latest add button card input form
   ```

4. フォーム管理とバリデーションライブラリの追加
   ```bash
   npm install react-hook-form @hookform/resolvers zod
   ```

5. コード品質ツールの設定
   ```bash
   npm install -D prettier @typescript-eslint/eslint-plugin
   ```

**推奨学習順序**:
まずはフェーズ1のステップ1.1（データベース接続）から始めて、一つずつ確実に進めていくことをお勧めします。各ステップで動作確認を行い、理解を深めながら進めていきましょう。

---

*この ロードマップは開発の進捗に応じて随時更新されます。*